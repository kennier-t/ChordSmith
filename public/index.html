<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Families</title>
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/guitar-pattern.css">
</head>
<body>
    <div id="app">
        <!-- Vista principal: familias de acordes -->
        <div id="families-view" class="view">
            <div class="top-buttons-container">
                <button id="gen-song-chords-btn" class="utility-btn">Gen Song Chords</button>
                <button id="open-songs-btn" class="utility-btn">Songs</button>
                <button id="create-chord-btn" class="utility-btn">Create Chord</button>
            </div>
            <h1>Chord Families</h1>
            <div class="families-grid">
                <button class="family-btn" data-family="C">C</button>
                <button class="family-btn" data-family="D">D</button>
                <button class="family-btn" data-family="E">E</button>
                <button class="family-btn" data-family="F">F</button>
                <button class="family-btn" data-family="G">G</button>
                <button class="family-btn" data-family="A">A</button>
                <button class="family-btn" data-family="B">B</button>
            </div>
        </div>

        <!-- Vista de familia: galería de acordes -->
        <div id="family-view" class="view hidden">
            <button id="back-to-families" class="back-btn">← Back</button>
            <h2 id="family-title"></h2>
            <div class="download-options">
                <button id="download-family-png" class="download-btn">Download Full Family (PNG)</button>
                <button id="download-family-svg" class="download-btn">Download Full Family (SVG)</button>
            </div>
            <div id="chords-gallery" class="chords-gallery"></div>
        </div>

        <!-- Modal para acorde individual -->
        <div id="chord-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="close-modal" class="close-btn">×</button>
                <h2 id="modal-chord-title"></h2>
                <div id="modal-chord-preview"></div>
                <div class="download-options">
                    <button id="download-modal-chord-png" class="download-btn">Download PNG</button>
                    <button id="download-modal-chord-svg" class="download-btn">Download SVG</button>
                </div>
            </div>
        </div>

        <!-- Modal para Gen Song Chords -->
        <div id="gen-song-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-gen-song-modal" class="close-btn">×</button>
                <h2>Generate Song Chords</h2>
                <p class="modal-description">Select up to 8 chords for your song (in order)</p>
                <div id="chord-selector-container">
                    <div class="chord-slot" data-slot="0">
                        <label>Chord 1:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="1">
                        <label>Chord 2:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="2">
                        <label>Chord 3:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="3">
                        <label>Chord 4:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="4">
                        <label>Chord 5:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="5">
                        <label>Chord 6:</label>
                        <select class="chord-select">
                            <option value="">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot chord-slot-extra" data-slot="6">
                        <label>Chord 7 (Optional):</label>
                        <select class="chord-select chord-select-extra" disabled>
                            <option value="">-- Fill first 6 chords --</option>
                        </select>
                    </div>
                    <div class="chord-slot chord-slot-extra" data-slot="7">
                        <label>Chord 8 (Optional):</label>
                        <select class="chord-select chord-select-extra-2" disabled>
                            <option value="">-- Fill chord 7 first --</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="generate-song-chords-btn" class="download-btn">Generate</button>
                </div>
                <div id="song-chords-preview" class="hidden">
                    <h3>Preview:</h3>
                    <div id="song-chords-image"></div>
                    <div class="download-options">
                        <button id="download-song-chords-png" class="download-btn">Download PNG</button>
                        <button id="download-song-chords-svg" class="download-btn">Download SVG</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Create Chord con CRUD -->
        <div id="create-chord-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-create-chord-modal" class="close-btn">×</button>
                <h2>Custom Chords</h2>
                
                <!-- Vista de Lista -->
                <div id="chord-list-view">
                    <button id="create-new-chord-btn" class="download-btn">Create New Chord</button>
                    <div id="custom-chords-list" class="custom-chords-list">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
                
                <!-- Vista de Editor -->
                <div id="chord-editor-view" class="hidden">
                    <button id="back-to-list-btn" class="back-btn">← Back to List</button>
                    
                    <div class="editor-container">
                        <div class="editor-controls">
                            <div class="form-group">
                                <label>Chord Name:</label>
                                <input type="text" id="chord-name-input" placeholder="e.g. Cmaj7" maxlength="10">
                                <span id="name-error" class="error-message"></span>
                            </div>
                            
                            <div class="form-group">
                                <label>Base Fret:</label>
                                <input type="number" id="base-fret-input" value="1" min="1" max="12">
                            </div>
                            
                            <div class="form-group">
                                <label>Instructions:</label>
                                <ul class="instructions-list">
                                    <li>Click on fret to add finger (1-4)</li>
                                    <li>Click above strings for X (not played)</li>
                                    <li>Drag across strings for barre</li>
                                    <li>Click finger to change number or remove</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="editor-canvas-container">
                            <canvas id="chord-editor-canvas" width="300" height="400"></canvas>
                        </div>
                    </div>
                    
                    <div class="editor-actions">
                        <button id="save-chord-btn" class="download-btn">Save Chord</button>
                        <button id="cancel-edit-btn" class="utility-btn">Cancel</button>
                        <button id="delete-chord-btn" class="utility-btn delete-btn hidden">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Songs Manager -->
        <div id="songs-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-songs-modal" class="close-btn">×</button>
                <h2>Songs</h2>
                
                <!-- Vista de Carpetas -->
                <div id="folders-view">
                    <div class="folders-actions">
                        <button id="create-new-folder-btn" class="download-btn">Create Folder</button>
                        <button id="create-new-song-btn" class="utility-btn">Create New Song</button>
                        <div class="sort-control">
                            <label for="folder-sort-select">Sort by:</label>
                            <select id="folder-sort-select">
                                <option value="date-asc">Date (Oldest First)</option>
                                <option value="date-desc">Date (Newest First)</option>
                                <option value="name-asc">Name (A-Z)</option>
                                <option value="name-desc">Name (Z-A)</option>
                                <option value="songs-desc">Songs (Most First)</option>
                                <option value="songs-asc">Songs (Least First)</option>
                            </select>
                        </div>
                    </div>
                    <div id="folders-list" class="folders-list"></div>
                </div>
                
                <!-- Vista de Lista de Canciones -->
                <div id="songs-list-view" class="hidden">
                    <button id="back-to-folders-btn" class="back-btn">← Back to Folders</button>
                    <h3 id="folder-title"></h3>
                    <div id="songs-list" class="songs-list"></div>
                </div>
            </div>
        </div>

        <!-- Modal Song Editor -->
        <div id="song-editor-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large modal-song-editor">
                <button id="close-song-editor-modal" class="close-btn">×</button>
                <h2>Create/Edit Song</h2>
                
                <div class="song-editor-container">
                    <!-- Metadatos -->
                    <div class="song-metadata">
                        <h3>Metadata</h3>
                        <table class="metadata-table">
                            <tr>
                                <td>Title:</td>
                                <td><input type="text" id="song-title-input" required></td>
                            </tr>
                            <tr>
                                <td>Date:</td>
                                <td><input type="text" id="song-date-input"></td>
                            </tr>
                            <tr>
                                <td>Notes:</td>
                                <td><input type="text" id="song-notes-input"></td>
                            </tr>
                            <tr>
                                <td>Key:</td>
                                <td><input type="text" id="song-key-input"></td>
                            </tr>
                            <tr>
                                <td>Capo:</td>
                                <td><input type="text" id="song-capo-input"></td>
                            </tr>
                            <tr>
                                <td>BPM:</td>
                                <td><input type="text" id="song-bpm-input"></td>
                            </tr>
                            <tr>
                                <td>Effects:</td>
                                <td><input type="text" id="song-effects-input"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Editor de contenido -->
                    <div class="song-content-editor">
                        <h3>Song Content</h3>
                        <textarea id="song-content-textarea" placeholder="Paste or type your song here...\n\nChords go on the line above lyrics.\nDouble line break separates sections."></textarea>
                    </div>
                    
                    <!-- Selector de diagramas -->
                    <div class="song-diagram-selector">
                        <h3>Selected Chords (up to 8)</h3>
                        <div id="selected-chords-list" class="selected-chords-list"></div>
                        
                        <h3>Available Chords</h3>
                        <div id="chord-selector-grid" class="chord-selector-grid"></div>
                    </div>
                    
                    <!-- Selector de carpetas -->
                    <div id="folder-selection" class="folder-selection"></div>
                    
                    <!-- Acciones -->
                    <div class="song-editor-actions">
                        <button id="save-song-btn" class="download-btn">Save Song</button>
                        <button id="cancel-song-edit-btn" class="utility-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts/guitar-pattern.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="scripts/dbService-api.js"></script>
    <script src="scripts/songsService-api.js"></script>
    <script src="scripts/chordData.js"></script>
    <script src="scripts/chordRenderer.js"></script>
    <script src="scripts/songPDFGenerator.js"></script>
    <script src="scripts/app.js"></script>
    <script src="scripts/songChords.js"></script>
    <script src="scripts/chordEditor.js"></script>
    <script src="scripts/songEditor.js"></script>
    <script src="scripts/songsManager.js"></script>
</body>
</html>
