<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Families</title>
    <link rel="icon" type="image/webp" href="assets/guitar.webp">
    <link rel="apple-touch-icon" href="assets/guitar.webp">
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/guitar-pattern.css">
    <link rel="stylesheet" href="styles/translation.css">
    <link rel="stylesheet" href="styles/practice-modal.css">
</head>
<body>
    <div id="app">
        <!-- Main view: chord families -->
        <div id="families-view" class="view">
            <img id="language-toggle" src="assets/translate.png" alt="Language Toggle">
            <div class="top-buttons-container">
                <button id="gen-song-chords-btn" class="utility-btn utility-btn-modern" data-translate="Gen Song Chords">Gen Song Chords</button>
                <button id="open-songs-btn" class="utility-btn utility-btn-modern" data-translate="Songs">Songs</button>
                <button id="create-chord-btn" class="utility-btn utility-btn-modern" data-translate="Create Chord">Create Chord</button>
                <button id="pdf-to-text-btn" class="utility-btn utility-btn-modern" data-translate="PDF → Text">PDF → Text</button>
            </div>
            <h1 data-translate="Chord Families">Chord Families</h1>
            <div class="families-grid">
                <button class="family-btn" data-family="C">C</button>
                <button class="family-btn" data-family="D">D</button>
                <button class="family-btn" data-family="E">E</button>
                <button class="family-btn" data-family="F">F</button>
                <button class="family-btn" data-family="G">G</button>
                <button class="family-btn" data-family="A">A</button>
                <button class="family-btn" data-family="B">B</button>
            </div>
        </div>

        <!-- Family view: chord gallery -->
        <div id="family-view" class="view hidden">
            <button id="back-to-families" class="back-btn" data-translate="← Back">← Back</button>
            <h2 id="family-title"></h2>
            <div class="download-options">
                <button id="download-family-png" class="download-btn" data-translate="Download Full Family (PNG)">Download Full Family (PNG)</button>
                <button id="download-family-svg" class="download-btn" data-translate="Download Full Family (SVG)">Download Full Family (SVG)</button>
                <button id="practice-family-btn" class="download-btn" data-translate="Practice">Practice</button>
            </div>
            <div id="chords-gallery" class="chords-gallery"></div>
        </div>

        <!-- Modal for individual chord -->
        <div id="chord-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="close-modal" class="close-btn">×</button>
                <h2 id="modal-chord-title"></h2>
                <div id="modal-chord-preview"></div>
                <div class="download-options">
                    <button id="download-modal-chord-png" class="download-btn" data-translate="Download PNG">Download PNG</button>
                    <button id="download-modal-chord-svg" class="download-btn" data-translate="Download SVG">Download SVG</button>
                </div>
            </div>
        </div>

        <!-- Practice Modal -->
        <div id="practice-modal" class="practice-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="practice-modal-title" data-translate="Practice Session">Practice Session</h2>
                    <button id="close-practice-modal" class="close-btn">×</button>
                </div>
                <div id="practice-modal-body" class="modal-body">
                    <!-- Chords will be injected here -->
                </div>
                <div class="modal-footer">
                    <button id="randomize-chords-btn" class="randomize-btn" data-translate="Randomize">Randomize</button>
                </div>
            </div>
        </div>

        <!-- Modal for Chord Variations -->
        <div id="chord-variation-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="close-variation-modal" class="close-btn">×</button>
                <h2 id="variation-modal-title" data-translate="Choose Variation">Choose Variation</h2>
                <div id="variation-grid" class="variation-grid">
                    <!-- Variations will be populated here -->
                </div>
                <div class="modal-actions">
                    <button id="add-variation-btn" class="editor-action-btn btn-primary" data-translate="Add Variation">Add Variation</button>
                    <button id="cancel-variation-btn" class="editor-action-btn btn-secondary" data-translate="Cancel">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal for Gen Song Chords -->
        <div id="gen-song-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-gen-song-modal" class="close-btn">×</button>
                <h2 data-translate="Generate Song Chords">Generate Song Chords</h2>
                <p class="modal-description" data-translate="Select up to 8 chords for your song (in order)">Select up to 8 chords for your song (in order)</p>
                <div id="chord-selector-container">
                    <div class="chord-slot" data-slot="0">
                        <label data-translate="Chord 1:">Chord 1:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="1">
                        <label data-translate="Chord 2:">Chord 2:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="2">
                        <label data-translate="Chord 3:">Chord 3:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="3">
                        <label data-translate="Chord 4:">Chord 4:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="4">
                        <label data-translate="Chord 5:">Chord 5:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot" data-slot="5">
                        <label data-translate="Chord 6:">Chord 6:</label>
                        <select class="chord-select">
                            <option value="" data-translate="-- Select Chord --">-- Select Chord --</option>
                        </select>
                    </div>
                    <div class="chord-slot chord-slot-extra" data-slot="6">
                        <label data-translate="Chord 7 (Optional):">Chord 7 (Optional):</label>
                        <select class="chord-select chord-select-extra" disabled>
                            <option value="" data-translate="-- Fill first 6 chords --">-- Fill first 6 chords --</option>
                        </select>
                    </div>
                    <div class="chord-slot chord-slot-extra" data-slot="7">
                        <label data-translate="Chord 8 (Optional):">Chord 8 (Optional):</label>
                        <select class="chord-select chord-select-extra-2" disabled>
                            <option value="" data-translate="-- Fill chord 7 first --">-- Fill chord 7 first --</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="generate-song-chords-btn" class="download-btn" data-translate="Generate">Generate</button>
                </div>
                <div id="song-chords-preview" class="hidden">
                    <h3 data-translate="Preview:">Preview:</h3>
                    <div id="song-chords-image"></div>
                    <div class="download-options">
                        <button id="download-song-chords-png" class="download-btn" data-translate="Download PNG">Download PNG</button>
                        <button id="download-song-chords-svg" class="download-btn" data-translate="Download SVG">Download SVG</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Create Chord with CRUD -->
        <div id="create-chord-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-create-chord-modal" class="close-btn">×</button>
                <h2 data-translate="Custom Chords">Custom Chords</h2>
                
                <!-- List View -->
                <div id="chord-list-view">
                    <button id="create-new-chord-btn" class="download-btn" data-translate="Create New Chord">Create New Chord</button>
                    <div id="custom-chords-list" class="custom-chords-list">
                        <!-- Filled dynamically -->
                    </div>
                </div>
                
                <!-- Editor View -->
                <div id="chord-editor-view" class="hidden">
                    <button id="back-to-list-btn" class="back-btn" data-translate="Back to List">← Back to List</button>
                    
                    <div class="editor-container">
                        <div class="editor-controls">
                            <div class="form-group">
                                <label data-translate="Chord Name:">Chord Name:</label>
                                <input type="text" id="chord-name-input" placeholder="e.g. Cmaj7" maxlength="10">
                                <span id="name-error" class="error-message"></span>
                            </div>
                            
                            <div class="form-group">
                                <label data-translate="Base Fret:">Base Fret:</label>
                                <input type="number" id="base-fret-input" value="1" min="1" max="12">
                            </div>

                            <div class="form-group">
                                <label class="folder-checkbox-label"><input type="checkbox" id="is-default-checkbox" class="is-default-checkbox"> <span data-translate="Set as Default">Set as Default</span></label>
                            </div>
                            
                            <div class="form-group">
                                <label data-translate="Instructions:">Instructions:</label>
                                <ul class="instructions-list">
                                    <li data-translate="Click on fret to add finger (1-4)">Click on fret to add finger (1-4)</li>
                                    <li data-translate="Click above strings for X (not played)">Click above strings for X (not played)</li>
                                    <li data-translate="Drag across strings for barre">Drag across strings for barre</li>
                                    <li data-translate="Click finger to change number or remove">Click finger to change number or remove</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="editor-canvas-container">
                            <canvas id="chord-editor-canvas" width="300" height="400"></canvas>
                        </div>
                    </div>
                    
                    <div class="editor-actions">
                        <button id="save-chord-btn" class="editor-action-btn btn-primary" data-translate="Save Chord">Save Chord</button>
                        <button id="cancel-edit-btn" class="editor-action-btn btn-secondary" data-translate="Cancel">Cancel</button>
                        <button id="delete-chord-btn" class="editor-action-btn btn-danger hidden" data-translate="Delete">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Chord Variations -->
        <div id="chord-variation-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <button id="close-variation-modal" class="close-btn">×</button>
                <h2 id="variation-modal-title" data-translate="Choose Variation">Choose Variation</h2>
                <div id="variation-grid" class="variation-grid">
                    <!-- Variations will be populated here -->
                </div>
                <div class="modal-actions">
                    <button id="add-variation-btn" class="editor-action-btn btn-primary" data-translate="Add Variation">Add Variation</button>
                    <button id="cancel-variation-btn" class="editor-action-btn btn-secondary" data-translate="Cancel">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Modal Songs Manager -->
        <div id="songs-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <button id="close-songs-modal" class="close-btn">×</button>
                <h2 data-translate="Songs">Songs</h2>
                
                <!-- Folders View -->
                <div id="folders-view">
                    <div class="folders-actions">
                        <button id="create-new-folder-btn" class="download-btn" data-translate="Create Folder">Create Folder</button>
                        <button id="create-new-song-btn" class="download-btn" data-translate="Create New Song">Create New Song</button>
                        <div class="sort-control">
                            <label for="folder-sort-select" data-translate="Sort by:">Sort by:</label>
                            <select id="folder-sort-select">
                                <option value="date-asc" data-translate="Date (Oldest First)">Date (Oldest First)</option>
                                <option value="date-desc" data-translate="Date (Newest First)">Date (Newest First)</option>
                                <option value="name-asc" data-translate="Name (A-Z)">Name (A-Z)</option>
                                <option value="name-desc" data-translate="Name (Z-A)">Name (Z-A)</option>
                                <option value="songs-desc" data-translate="Songs (Most First)">Songs (Most First)</option>
                                <option value="songs-asc" data-translate="Songs (Least First)">Songs (Least First)</option>
                            </select>
                        </div>
                    </div>
                    <div id="folders-list" class="folders-list"></div>
                </div>
                
                <!-- Songs List View -->
                <div id="songs-list-view" class="hidden">
                    <button id="back-to-folders-btn" class="back-btn" data-translate="Back to Folders">← Back to Folders</button>
                    <div class="songs-list-header">
                        <h3 id="folder-title"></h3>
                        <div id="all-songs-sort-control" class="sort-control hidden">
                            <label for="all-songs-sort-btn" data-translate="Sort by:">Sort by:</label>
                            <div class="custom-select-container">
                                <button id="all-songs-sort-btn" class="custom-select" onclick="SongsManager.toggleSortDropdown()">
                                    <span id="all-songs-sort-display">Key</span>
                                    <span class="custom-select-arrow"></span>
                                </button>
                                <div id="all-songs-sort-dropdown" class="custom-dropdown hidden">
                                    <div class="custom-dropdown-item" data-value="key" onclick="SongsManager.selectSortOption('key')" data-translate="Key">Key</div>
                                    <div class="custom-dropdown-item" data-value="folder" onclick="SongsManager.selectSortOption('folder')" data-translate="Folder">Folder</div>
                                    <div class="custom-dropdown-item" data-value="artist" onclick="SongsManager.selectSortOption('artist')" data-translate="Artist">Artist</div>
                                </div>
                            </div>
                            <label for="value-filter-btn" data-translate="Visible:">Visible:</label>
                            <div class="custom-select-container">
                                <button id="value-filter-btn" class="custom-select" onclick="SongsManager.toggleValueDropdown()">
                                    <span id="value-filter-display">All</span>
                                    <span class="custom-select-arrow"></span>
                                </button>
                                <div id="value-dropdown" class="custom-dropdown hidden">
                                    <!-- Options will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="songs-list" class.songs-list"></div>
                </div>
            </div>
        </div>

        <!-- Modal Song Editor -->
        <div id="song-editor-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large modal-song-editor">
                <button id="close-song-editor-modal" class="close-btn">×</button>
                <h2 data-translate="Create/Edit Song">Create/Edit Song</h2>
                
                <div class="song-editor-container">
                    <!-- Metadata -->
                    <div class="song-metadata">
                        <h3 data-translate="Metadata">Metadata</h3>
                        <table class="metadata-table">
                            <tr>
                                <td data-translate="Title:">Title:</td>
                                <td><input type="text" id="song-title-input" required></td>
                            </tr>
                            <tr>
                                <td data-translate="Date:">Date:</td>
                                <td><input type="text" id="song-date-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="Notes:">Notes:</td>
                                <td><input type="text" id="song-notes-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="Key:">Key:</td>
                                <td><input type="text" id="song-key-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="Capo:">Capo:</td>
                                <td><input type="text" id="song-capo-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="BPM:">BPM:</td>
                                <td><input type="text" id="song-bpm-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="Effects:">Effects:</td>
                                <td><input type="text" id="song-effects-input"></td>
                            </tr>
                            <tr>
                                <td data-translate="Song Content font size (pt):">Font Size:</td>
                                <td><input type="number" id="song-content-font-size-input" min="6" max="15" step="1" placeholder="11"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- Content Editor -->
                    <div class="song-content-editor">
                        <div class="content-header">
                            <h3 data-translate="Song Content">Song Content</h3>
                            <div class="column-guides-control">
                                <label for="column-guides-select" data-translate="Column Guides:">Column Guides:</label>
                                <select id="column-guides-select">
                                    <option value="none" selected data-translate="None">None</option>
                                    <option value="personalized" data-translate="Personalized">Personalized</option>
                                    <option value="two-personalized" data-translate="Two Personalized">Two Personalized</option>
                                    <option value="two" data-translate="2 Columns">2 Columns</option>
                                    <option value="three" data-translate="3 Columns">3 Columns</option>
                                </select>
                            </div>
                        </div>
                        <div class="textarea-wrapper">
                            <textarea id="song-content-textarea" 
                                      placeholder="Paste or type your song here...\n\nChords go on the line above lyrics.\nDouble line break separates sections."
                                      data-translate-placeholder-1="Paste or type your song here..."
                                      data-translate-placeholder-2="Chords go on the line above lyrics."
                                      data-translate-placeholder-3="Double line break separates sections."></textarea>
                            <div id="column-guides" class="column-guides"></div>
                        </div>
                    </div>
                    
                    <!-- Diagram Selector -->
                    <div class="song-diagram-selector">
                        <h3 data-translate="Selected Chords (up to 8)">Selected Chords (up to 8)</h3>
                        <div id="selected-chords-list" class="selected-chords-list"></div>
                        
                        <h3 data-translate="Available Chords">Available Chords</h3>
                        <div id="chord-selector-grid" class="chord-selector-grid"></div>
                    </div>
                    
                    <!-- Folder Selector -->
                    <div id="folder-selection" class="folder-selection"></div>
                    
                    <!-- Actions -->
                    <div class="song-editor-actions">
                        <button id="save-song-btn" class="editor-action-btn btn-primary" data-translate="Save Song">Save Song</button>
                        <button id="cancel-song-edit-btn" class="editor-action-btn btn-secondary" data-translate="Cancel">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts/translation.js"></script>
    <script src="scripts/guitar-pattern.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="scripts/dbService-api.js"></script>
    <script src="scripts/songsService-api.js"></script>
    <script src="scripts/chordRenderer.js"></script>
    <script src="scripts/songPDFGenerator.js"></script>
    <script src="scripts/app.js"></script>
    <script src="scripts/songChords.js"></script>
    <script src="scripts/chordEditor.js"></script>
    <script src="scripts/songEditor.js"></script>
    <script src="scripts/songsManager.js"></script>
</body>
</html>
