const translations = {
    en: {
        'Gen Song Chords': 'Gen Song Chords',
        'Songs': 'Songs',
        'Shares': 'Shares',
        'Create Chord': 'Create Chord',
        'PDF → Text': 'PDF → Text',
        'ChordSmith': 'ChordSmith',
        '← Back': '← Back',
        '? Back': '? Back',
        'PDF Preview': 'PDF Preview',
        'Loading PDF preview...': 'Loading PDF preview...',
        'Unable to load PDF preview.': 'Unable to load PDF preview.',
        'Download Full Family (PNG)': 'Download Full Family (PNG)',
        'Download Full Family (SVG)': 'Download Full Family (SVG)',
        'Download': 'Download',
        'Download PNG': 'Download PNG',
        'Download SVG': 'Download SVG',
        'Generate Song Chords': 'Generate Song Chords',
        'Select up to 8 chords for your song (in order)': 'Select up to 8 chords for your song (in order)',
        'Chord 1:': 'Chord 1:',
        'Chord 2:': 'Chord 2:',
        'Chord 3:': 'Chord 3:',
        'Chord 4:': 'Chord 4:',
        'Chord 5:': 'Chord 5:',
        'Chord 6:': 'Chord 6:',
        'Chord 7 (Optional):': 'Chord 7 (Optional):',
        'Chord 8 (Optional):': 'Chord 8 (Optional):',
        '-- Select Chord --': '-- Select Chord --',
        '-- Fill first 6 chords --': '-- Fill first 6 chords --',
        '-- Fill chord 7 first --': '-- Fill chord 7 first --',
        'Generate': 'Generate',
        'Preview:': 'Preview:',
        'Custom Chords': 'Custom Chords',
        'Create New Chord': 'Create New Chord',
        'Back to List': 'Back to List',
        'Chord Name:': 'Chord Name:',
        'Base Fret:': 'Base Fret:',
        'Instructions:': 'Instructions:',
        'Click on fret to add finger (1-4)': 'Click on fret to add finger (1-4)',
        'Click above strings for X (not played)': 'Click above strings for X (not played)',
        'Drag across strings for barre': 'Drag across strings for barre',
        'Click finger to change number or remove': 'Click finger to change number or remove',
        'Save Chord': 'Save Chord',
        'Cancel': 'Cancel',
        'Delete': 'Delete',
        'Create Folder': 'Create Folder',
        'Create New Song': 'Create New Song',
        'Sort by:': 'Sort by:',
        'Date (Oldest First)': 'Date (Oldest First)',
        'Date (Newest First)': 'Date (Newest First)',
        'Name (A-Z)': 'Name (A-Z)',
        'Name (Z-A)': 'Name (Z-A)',
        'Songs (Most First)': 'Songs (Most First)',
        'Songs (Least First)': 'Songs (Least First)',
        'Back to Folders': 'Back to Folders',
        'Create/Edit Song': 'Create/Edit Song',
        'Metadata': 'Metadata',
        'Title:': 'Title:',
        'Date:': 'Date:',
        'Notes:': 'Notes:',
        'Key:': 'Key:',
        'Capo:': 'Capo:',
        'BPM:': 'BPM:',
        'Effects:': 'Effects:',
        'Song Content': 'Song Content',
        'Page Layout:': 'Page Layout:',
        'Single Column': 'Single Column',
        'Two Columns': 'Two Columns',
        'Column Guides:': 'Column Guides:',
        'None': 'None',
        'Personalized': 'Personalized',
        '2 Columns': '2 Columns',
        '3 Columns': '3 Columns',
        'Paste or type your song here...': 'Paste or type your song here...',
        'Chords go on the line above lyrics.': 'Chords go on the line above lyrics.',
        'Double line break separates sections.': 'Double line break separates sections.',
        'Selected Chords (up to 8)': 'Selected Chords (up to 8)',
        'Available Chords': 'Available Chords',
        'Save Song': 'Save Song',
                'Edit': 'Edit',
                'Rename': 'Rename',
                'Save to folders': 'Save to folders',
                'No custom chords yet. Create one!': 'No custom chords yet. Create one!',
                'No folders yet. Create one to organize your songs!': 'No folders yet. Create one to organize your songs!',
                'No songs in this folder. Create your first song!': 'No songs in this folder. Create your first song!',
                'Enter folder name:': 'Enter folder name:',
                'Enter new folder name:': 'Enter new folder name:',
                'Delete this folder? Songs will not be deleted, only removed from this folder.': 'Delete this folder? Songs will not be deleted, only removed from this folder.',
                'Delete song': 'Delete song',
                'C Family': 'C Family',
                'D Family': 'D Family',
                'E Family': 'E Family',
                'F Family': 'F Family',
                'G Family': 'G Family',
                'A Family': 'A Family',
                'B Family': 'B Family',
                        'Select PDF': 'Select PDF',
                        'Drag & drop': 'Drag & drop',
                        'your PDF here': 'your PDF here',
                        'or click to select': 'or click to select',
                        'No file selected': 'No file selected',
                        'Convert': 'Convert',
                        'Preserves formatting and spacing using pdftotext -layout': 'Preserves formatting and spacing using pdftotext -layout',
                        'Converted Text': 'Converted Text',
                        'Converted text will appear here...': 'Converted text will appear here...',
                        'Copy': 'Copy',
                        'Clear': 'Clear',
        'Ready': 'Ready',
        'Chord': 'Chord',
        'Send Share': 'Send Share',
        'Type:': 'Type:',
        'Item:': 'Item:',
        'Select an item': 'Select an item',
        'Recipient Username:': 'Recipient Username:',
        'Incoming Shares': 'Incoming Shares',
        'Song Shares': 'Song Shares',
        'Chord Shares': 'Chord Shares',
        'from': 'from',
        'Accept': 'Accept',
        'Reject': 'Reject',
        'Select Folders for the Song': 'Select Folders for the Song',
        'Please select an item and enter a recipient username.': 'Please select an item and enter a recipient username.',
        'An error occurred loading folders. Please try again.': 'An error occurred loading folders. Please try again.',
        'Your Profile': 'Your Profile',
        'Username': 'Username',
        'Email': 'Email',
        'First Name': 'First Name',
        'Last Name': 'Last Name',
        'Language': 'Language',
        'Update Profile': 'Update Profile',
        'Change Password': 'Change Password',
        'New Password': 'New Password',
        'Login': 'Login',
        'Password': 'Password',
        'Don\'t have an account?': 'Don\'t have an account?',
        'Register here': 'Register here',
        'Forgot your password?': 'Forgot your password?',
        'Register': 'Register',
        'Already have an account?': 'Already have an account?',
        'Login here': 'Login here',
        'Reset Password': 'Reset Password',
        'Confirm New Password': 'Confirm New Password',
        'Send Reset Link': 'Send Reset Link',
        'Enter New Password': 'Enter New Password',
        'Passwords do not match.': 'Passwords do not match.',
        'An error occurred. Please try again.': 'An error occurred. Please try again.',
        'Profile updated successfully': 'Profile updated successfully',
        'Password changed successfully': 'Password changed successfully',
        'Settings': 'Settings',
        'Log out': 'Log out',
        'Family is not yet implemented.': 'Family {family} is not yet implemented.',
        'No chords available to download in this family.': 'No chords available to download in this family.',
        'Please enter a recipient username.': 'Please enter a recipient username.',
        'All Songs': 'All Songs',
        'of': 'of',
        'Chord not found': 'Chord not found',
        'Cannot edit original chords': 'Cannot edit original chords',
        'Please enter a chord name': 'Please enter a chord name',
        'Please place at least one finger on the diagram': 'Please place at least one finger on the diagram',
        'Chord updated successfully!': 'Chord updated successfully!',
        'Chord created successfully!': 'Chord created successfully!',
        'Error saving chord: ': 'Error saving chord: ',
        'Are you sure you want to delete this chord?': 'Are you sure you want to delete this chord?',
        'Chord deleted successfully!': 'Chord deleted successfully!',
        'Error deleting chord: ': 'Error deleting chord: ',
        'Error: Please select a PDF file': 'Error: Please select a PDF file',
        'Ready to convert': 'Ready to convert',
        'Error: No file selected': 'Error: No file selected',
        'Converting...': 'Converting...',
        'Error': 'Error',
        'Unknown error': 'Unknown error',
        'Details': 'Details',
        'Completed': 'Completed',
        'Connection error': 'Connection error',
        'Nothing to copy': 'Nothing to copy',
        'Copied to clipboard': 'Copied to clipboard',
        'Copied (fallback)': 'Copied (fallback)',
                        'song': 'song',
                        'songs': 'songs',
                        'All': 'All',
                        'Unknown': 'Unknown',
                        'Uncategorized': 'Uncategorized',
                        'Key': 'Key',
                        'Folder': 'Folder',
                        'Artist': 'Artist',
                        'Visible Keys:': 'Visible Keys:',
                        'Visible Folders:': 'Visible Folders:',
                        'Visible Artists:': 'Visible Artists:',
                        'Visible': 'Visible',
                        'Choose Variation': 'Choose Variation',
                        'Add Variation': 'Add Variation',
                        'Make Default': 'Make Default',
                        'Already Default': 'Already Default',
                        'Set as Default': 'Set as Default',
                        'Default variation updated successfully': 'Default variation updated successfully',
                        'Variations for': 'Variations for',
                        'Please create at least one folder before creating a song.': 'Please create at least one folder before creating a song.',
                        'Practice': 'Practice',
                        'Practice Session': 'Practice Session',
                        'Randomize': 'Randomize',
	                        'No chords available for practice in this family.': 'No chords available for practice in this family.',
	                        ' Family Practice': ' Family Practice',
	                        'English': 'English',
	                        'Spanish': 'Spanish',
	                    },
                    es: {
                        'Gen Song Chords': 'Generar Acordes',
                        'Songs': 'Canciones',
                        'Create Chord': 'Crear Acorde',
                        'PDF → Text': 'PDF \u2192 Texto',
                        'ChordSmith': 'ChordSmith',
                        '← Back': '\u2190 Volver',
                        '? Back': '\u2190 Volver',
                        'PDF Preview': 'Vista Previa PDF',
                        'Loading PDF preview...': 'Cargando vista previa del PDF...',
                        'Unable to load PDF preview.': 'No se pudo cargar la vista previa del PDF.',
                        'Download Full Family (PNG)': 'Descargar Familia (PNG)',
                        'Download Full Family (SVG)': 'Descargar Familia (SVG)',
                        'Download': 'Descargar',
                        'Download PNG': 'Descargar PNG',
                        'Download SVG': 'Descargar SVG',
                        'Generate Song Chords': 'Generar Acordes de Canci\u00f3n',
                        'Select up to 8 chords for your song (in order)': 'Selecciona hasta 8 acordes para tu canci\u00f3n (en orden)',
                        'Chord 1:': 'Acorde 1:',
                        'Chord 2:': 'Acorde 2:',
                        'Chord 3:': 'Acorde 3:',
                        'Chord 4:': 'Acorde 4:',
                        'Chord 5:': 'Acorde 5:',
                        'Chord 6:': 'Acorde 6:',
                        'Chord 7 (Optional):': 'Acorde 7 (Opcional):',
                        'Chord 8 (Optional):': 'Acorde 8 (Opcional):',
                        '-- Select Chord --': '-- Seleccionar Acorde --',
                        '-- Fill first 6 chords --': '-- Llena los primeros 6 acordes --',
                        '-- Fill chord 7 first --': '-- Llena el acorde 7 primero --',
                        'Generate': 'Generar',
                        'Preview:': 'Vista Previa:',
                        'Custom Chords': 'Acordes Personalizados',
                        'Create New Chord': 'Crear Nuevo Acorde',
                        'Back to List': 'Volver a la Lista',
                        'Chord Name:': 'Nombre del Acorde:',
                        'Base Fret:': 'Traste Base:',
                        'Instructions:': 'Instrucciones:',
                        'Click on fret to add finger (1-4)': 'Haz clic en el traste para agregar el dedo (1-4)',
                        'Click above strings for X (not played)': 'Haz clic arriba de las cuerdas para X (no se toca)',
                        'Drag across strings for barre': 'Arrastra a trav\u00e9s de las cuerdas para la cejilla',
                        'Click finger to change number or remove': 'Haz clic en el dedo para cambiar el n\u00famero o eliminar',
                        'Save Chord': 'Guardar Acorde',
                        'Cancel': 'Cancelar',
                        'Delete': 'Eliminar',
                        'Create Folder': 'Crear Carpeta',
                        'Create New Song': 'Crear Nueva Canci\u00f3n',
                        'Sort by:': 'Ordenar por:',
                        'Date (Oldest First)': 'Fecha (Antiguos Primero)',
                        'Date (Newest First)': 'Fecha (Nuevos Primero)',
                        'Name (A-Z)': 'Nombre (A-Z)',
                        'Name (Z-A)': 'Nombre (Z-A)',
                        'Songs (Most First)': 'Canciones (M\u00e1s Primero)',
                        'Songs (Least First)': 'Canciones (Menos Primero)',
                        'Back to Folders': 'Volver a las Carpetas',
                        'Create/Edit Song': 'Crear/Editar Canci\u00f3n',
                        'Metadata': 'Metadatos',
                        'Title:': 'T\u00edtulo:',
                        'Date:': 'Fecha:',
                        'Notes:': 'Notas:',
                        'Key:': 'Tonalidad:',
                        'Capo:': 'Capo:',
                        'BPM:': 'BPM:',
                        'Effects:': 'Efectos:',
                        'Song Content': 'Contenido de la Canci\u00f3n',
                        'Column Guides:': 'Gu\u00edas de Columna:',
                        'None': 'Ninguna',
                        'Personalized': 'Personalizadas',
                        '2 Columns': '2 Columnas',
                        'Page Layout:': 'Dise\u00f1o de P\u00e1gina:',
                        'Single Column': 'Una Columna',
                        'Two Columns': 'Dos Columnas',
                        '3 Columns': '3 Columnas',
                        'Paste or type your song here...': 'Pega o escribe tu canci\u00f3n aqu\u00ed...',
                        'Chords go on the line above lyrics.': 'Los acordes van en la l\u00ednea sobre la letra.',
                        'Double line break separates sections.': 'El doble salto de l\u00ednea separa las secciones.',
                        'Selected Chords (up to 8)': 'Acordes Seleccionados (hasta 8)',
                        'Available Chords': 'Acordes Disponibles',
                        'Save Song': 'Guardar Canci\u00f3n',
                        'Edit': 'Editar',
                        'Rename': 'Renombrar',
                        'Save to folders': 'Guardar en carpetas',
                        'No custom chords yet. Create one!': 'A\u00fan no hay acordes personalizados. \u00a1Crea uno!',
                        'No folders yet. Create one to organize your songs!': 'No hay carpetas todav\u00eda. \u00a1Crea una para organizar tus canciones!',
                        'No songs in this folder. Create your first song!': 'No hay canciones en esta carpeta. \u00a1Crea tu primera canci\u00f3n!',
                        'Enter folder name:': 'Introduce el nombre de la carpeta:',
                        'Enter new folder name:': 'Introduce el nuevo nombre de la carpeta:',
                        'Delete this folder? Songs will not be deleted, only removed from this folder.': '\u00bfEliminar esta carpeta? Las canciones no se eliminar\u00e1n, solo se quitar\u00e1n de esta carpeta.',
                        'Delete song': 'Eliminar canci\u00f3n',
                        'C Family': 'Familia de C',
                        'D Family': 'Familia de D',
                        'E Family': 'Familia de E',
                        'F Family': 'Familia de F',
                        'G Family': 'Familia de G',
                        'A Family': 'Familia de A',
                        'B Family': 'Familia de B',
                        'Select PDF': 'Seleccionar PDF',
                        'Drag & drop': 'Arrastra y suelta',
                        'your PDF here': 'tu PDF aqu\u00ed',
                        'or click to select': 'o haz clic para seleccionar',
                        'No file selected': 'Ning\u00fan archivo seleccionado',
                        'Convert': 'Convertir',
                        'Preserves formatting and spacing using pdftotext -layout': 'Conserva el formato y el espaciado usando pdftotext -layout',
                        'Converted Text': 'Texto Convertido',
                        'Converted text will appear here...': 'El texto convertido aparecer\u00e1 aqu\u00ed...',
                        'Copy': 'Copiar',
                        'Clear': 'Limpiar',
                        'Ready': 'Listo',
                        'Chord': 'Acorde',
                        'Send Share': 'Enviar Compartido',
                        'Type:': 'Tipo:',
                        'Item:': 'Elemento:',
                        'Select an item': 'Selecciona un elemento',
                        'Recipient Username:': 'Usuario destinatario:',
                        'Incoming Shares': 'Compartidos Recibidos',
                        'Song Shares': 'Canciones Compartidas',
                        'Chord Shares': 'Acordes Compartidos',
                        'from': 'de',
                        'Accept': 'Aceptar',
                        'Reject': 'Rechazar',
                        'Select Folders for the Song': 'Selecciona carpetas para la canci\u00f3n',
                        'Please select an item and enter a recipient username.': 'Selecciona un elemento e ingresa un usuario destinatario.',
                        'An error occurred loading folders. Please try again.': 'Ocurri\u00f3 un error cargando carpetas. Intenta de nuevo.',
                        'Your Profile': 'Tu Perfil',
                        'Username': 'Usuario',
                        'Email': 'Correo',
                        'First Name': 'Nombre',
                        'Last Name': 'Apellido',
                        'Language': 'Idioma',
                        'Update Profile': 'Actualizar Perfil',
                        'Change Password': 'Cambiar Contrase\u00f1a',
                        'New Password': 'Nueva Contrase\u00f1a',
                        'Login': 'Iniciar Sesi\u00f3n',
                        'Password': 'Contrase\u00f1a',
                        'Don\'t have an account?': '\u00bfNo tienes cuenta?',
                        'Register here': 'Reg\u00edstrate aqu\u00ed',
                        'Forgot your password?': '\u00bfOlvidaste tu contrase\u00f1a?',
                        'Register': 'Registrarse',
                        'Already have an account?': '\u00bfYa tienes cuenta?',
                        'Login here': 'Inicia sesi\u00f3n aqu\u00ed',
                        'Reset Password': 'Restablecer Contrase\u00f1a',
                        'Confirm New Password': 'Confirmar Nueva Contrase\u00f1a',
                        'Send Reset Link': 'Enviar Enlace de Reinicio',
                        'Enter New Password': 'Ingresa Nueva Contrase\u00f1a',
                        'Passwords do not match.': 'Las contrase\u00f1as no coinciden.',
                        'An error occurred. Please try again.': 'Ocurri\u00f3 un error. Intenta de nuevo.',
                        'Profile updated successfully': 'Perfil actualizado correctamente',
                        'Password changed successfully': 'Contrase\u00f1a actualizada correctamente',
                        'Settings': 'Configuraci\u00f3n',
                        'Log out': 'Cerrar sesi\u00f3n',
                        'Family is not yet implemented.': 'La familia {family} a\u00fan no est\u00e1 implementada.',
                        'No chords available to download in this family.': 'No hay acordes disponibles para descargar en esta familia.',
                        'Please enter a recipient username.': 'Ingresa un usuario destinatario.',
                        'All Songs': 'Todas las Canciones',
                        'of': 'de',
                        'Chord not found': 'Acorde no encontrado',
                        'Cannot edit original chords': 'No se pueden editar acordes originales',
                        'Please enter a chord name': 'Ingresa un nombre de acorde',
                        'Please place at least one finger on the diagram': 'Coloca al menos un dedo en el diagrama',
                        'Chord updated successfully!': 'Acorde actualizado correctamente!',
                        'Chord created successfully!': 'Acorde creado correctamente!',
                        'Error saving chord: ': 'Error guardando acorde: ',
                        'Are you sure you want to delete this chord?': '\u00bfSeguro que deseas eliminar este acorde?',
                        'Chord deleted successfully!': 'Acorde eliminado correctamente!',
                        'Error deleting chord: ': 'Error eliminando acorde: ',
                        'Error: Please select a PDF file': 'Error: Selecciona un archivo PDF',
                        'Ready to convert': 'Listo para convertir',
                        'Error: No file selected': 'Error: No hay archivo seleccionado',
                        'Converting...': 'Convirtiendo...',
                        'Error': 'Error',
                        'Unknown error': 'Error desconocido',
                        'Details': 'Detalles',
                        'Completed': 'Completado',
                        'Connection error': 'Error de conexi\u00f3n',
                        'Nothing to copy': 'Nada para copiar',
                        'Copied to clipboard': 'Copiado al portapapeles',
                        'Copied (fallback)': 'Copiado (alternativo)',
                        'No folders available. Create one in Songs view first.': 'No hay carpetas disponibles. Crea una primero en la vista de Canciones.',
                        'already selected': 'ya seleccionado',
                        'No chords selected. Click on chords below to add them.': 'No hay acordes seleccionados. Haz clic en los acordes abajo para agregarlos.',
                        'Song content cannot be empty': 'El contenido de la canci\u00f3n no puede estar vac\u00edo',
                        'Title is required': 'El t\u00edtulo es obligatorio',
                        'Maximum 8 chords allowed': 'M\u00e1ximo 8 acordes permitidos',
                        'Song not found': 'Canci\u00f3n no encontrada',
                        'Song updated successfully!': '\u00a1Canci\u00f3n actualizada exitosamente!',
                        'Song created successfully!': '\u00a1Canci\u00f3n creada exitosamente!',
                        'Error saving song: ': 'Error guardando canci\u00f3n: ',
                        'song': 'canci\u00f3n',
                        'songs': 'canciones',
                        'All': 'TODAS',
                        'Unknown': 'Desconocida',
                        'Uncategorized': 'Sin categor\u00eda',
                        'Key': 'Tonalidad',
                        'Folder': 'Carpeta',
                        'Artist': 'Artista',
                        'Visible Keys:': 'Tonalidades Visibles:',
                        'Visible Folders:': 'Carpetas Visibles:',
                        'Visible Artists:': 'Artistas Visibles:',
                        'Visible': 'Visibles',
                        'Choose Variation': 'Elegir Variaci\u00f3n',
                        'Add Variation': 'Agregar Variaci\u00f3n',
                        'Make Default': 'Hacer Predeterminado',
                        'Already Default': 'Ya Predeterminado',
                        'Set as Default': 'Establecer como Predeterminado',
                        'Default variation updated successfully': 'Variaci\u00f3n predeterminada actualizada exitosamente',
                        'Variations for': 'Variaciones para',
                        'Please create at least one folder before creating a song.': 'Por favor, crea al menos una carpeta antes de crear una canci\u00f3n.',
                        'Practice': 'Practicar',
                        'Practice Session': 'Sesi\u00f3n de Pr\u00e1ctica',
                        'Randomize': 'Aleatorizar',
                        'No chords available for practice in this family.': 'No hay acordes disponibles para practicar en esta familia.',
                        ' Family Practice': ' Pr\u00e1ctica de Familia',
                        'Shares': 'Compartidos',
                        'Share': 'Compartir',
                        'Recipient Username': 'Nombre de usuario del destinatario',
                        'English': 'Ingl\u00e9s',
                        'Spanish': 'Espa\u00f1ol',
                    }};

const supportedLanguages = ['en', 'es'];
let currentLanguage = normalizeLanguage(localStorage.getItem('language') || 'en');

function normalizeLanguage(lang) {
    return supportedLanguages.includes(lang) ? lang : 'en';
}

function getStoredToken() {
    return localStorage.getItem('token');
}

async function persistLanguagePreference(lang) {
    const token = getStoredToken();
    if (!token) {
        return false;
    }

    try {
        const res = await fetch('/api/users/me/language', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ language_pref: lang })
        });
        return res.ok;
    } catch (error) {
        console.error('Failed to persist language preference:', error);
        return false;
    }
}

async function getLanguagePreferenceFromServer() {
    const token = getStoredToken();
    if (!token) {
        return null;
    }

    try {
        const res = await fetch('/api/users/me', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (!res.ok) {
            return null;
        }

        const user = await res.json();
        return normalizeLanguage(user.language_pref);
    } catch (error) {
        console.error('Failed to load language preference:', error);
        return null;
    }
}

function setLanguage(lang, options = {}) {
    const normalizedLanguage = normalizeLanguage(lang);
    currentLanguage = normalizedLanguage;
    localStorage.setItem('language', normalizedLanguage);
    translatePage();

    if (options.persistRemote) {
        return persistLanguagePreference(normalizedLanguage);
    }

    return Promise.resolve(true);
}

function translatePage() {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            el.textContent = translations[currentLanguage][key];
        }
    });

    const textareas = document.querySelectorAll('textarea[data-translate-placeholder-1]');
    textareas.forEach(el => {
        const key1 = el.getAttribute('data-translate-placeholder-1');
        const key2 = el.getAttribute('data-translate-placeholder-2');
        const key3 = el.getAttribute('data-translate-placeholder-3');
        
        if (translations[currentLanguage]) {
            const placeholder1 = translations[currentLanguage][key1] || '';
            const placeholder2 = translations[currentLanguage][key2] || '';
            const placeholder3 = translations[currentLanguage][key3] || '';
            
            el.placeholder = `${placeholder1}\n\n${placeholder2}\n${placeholder3}`;
        }
    });

    const single_textareas = document.querySelectorAll('textarea[data-translate-placeholder]');
    single_textareas.forEach(el => {
        const key = el.getAttribute('data-translate-placeholder');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            el.placeholder = translations[currentLanguage][key];
        }
    });
}

document.addEventListener('DOMContentLoaded', async () => {
    const langToggle = document.getElementById('language-toggle');
    if (langToggle) {
        langToggle.addEventListener('click', () => {
            const newLang = currentLanguage === 'en' ? 'es' : 'en';
            setLanguage(newLang, { persistRemote: true });
        });
    }

    translatePage();

    const serverLanguage = await getLanguagePreferenceFromServer();
    if (serverLanguage && serverLanguage !== currentLanguage) {
        setLanguage(serverLanguage, { persistRemote: false });
    }
});



